const request = require('./requestService');

class PublishService {
    constructor() {
        this.report = null;
        this.reportKey = null;
        this.apiKey = null;
    }

    getReportKey() {
        request('/get-token', 'POSt', {
            API_KEY: this.apiKey
        }).then(res => {
            this.reportKey = res.token;
            this.uploadReport();
        })
    }

    setApiKey(apiKey ) {
        if (!this.apiKey) {
            this.apiKey = apiKey;
            this.getReportKey();
        }
    }

    uploadReport() {
        if (this.report) {
            request(`/set-report/${this.reportKey}`,'POST',this.report)
        } else console.log('not uploading report')
    }

    setReport(report) {
        this.report = report;
        if (this.reportKey) this.uploadReport();
    }
}

module.exports = new PublishService();