const http = require("http");
var os = require("os");

function request(path, method = 'GET', data) {
    // const postData = JSON.stringify({
    //     API_KEY: "EG7f5q8k6LAYhDBbuXgQ"
    // })
    return new Promise((promiseResponse, promiseReject)=> {
        const postData = JSON.stringify(data)
        const dataHeader = data ? {'Content-Length': Buffer.byteLength(postData)} : {}
        const options = {
            hostname: "kpajtasev-cypress-dashboard.herokuapp.com",
            port: 80,
            path,
            method,
            headers: {
                'Content-Type': 'application/json',
                ...dataHeader
            }
        };
        const req = http.request(options, (res) => {
            // console.log(`STATUS: ${res.statusCode}`);
            // console.log(`HEADERS: ${JSON.stringify(res.headers)}`);
            res.setEncoding('utf8');
            let data = "";
            res.on('data', (chunk) => {
                // console.log(`BODY: ${chunk}`);
                data += chunk;
            });
            res.on('end', () => {
                promiseResponse(JSON.parse(data));
                // console.log('No more data in response.');
            });
        });

        req.on('error', (e) => {
            // console.error(`problem with request: ${e.message}`);
            promiseReject(e.message);
        });

        req.write(postData);
        req.end()

    })


}

module.exports = request;